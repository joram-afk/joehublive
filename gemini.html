<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2285%22>üí∏</text></svg>">
  <title>JOE HUB | Business Toolkit</title>
  <style>
    :root { --primary: #00D366; --secondary: #FFD700; --bg: #090c10; --card: #161b22; --text: #f0f6fc; --danger: #ff4444; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }

    header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 10px; }
    h1 span { color: var(--primary); }

    .action-bar { max-width: 1400px; margin: 0 auto 20px; display: flex; gap: 10px; justify-content: flex-end; }
    button { cursor: pointer; border: none; border-radius: 6px; padding: 10px 15px; font-weight: bold; transition: 0.3s; }
    .btn-pdf { background: var(--secondary); color: black; }
    .btn-refresh { background: #30363d; color: white; }
    .btn-add { background: var(--primary); color: white; margin-top: 10px; width: 100%; }

    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; max-width: 1400px; margin: 0 auto; }
    .card { background: var(--card); border: 1px solid #30363d; border-radius: 12px; padding: 20px; }
    
    /* Table Styling */
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.85rem; }
    th { text-align: left; color: #8b949e; padding-bottom: 10px; border-bottom: 1px solid #333; }
    td { padding: 10px 0; border-bottom: 1px solid #21262d; }
    .delete-btn { color: var(--danger); background: none; padding: 0; font-size: 1.1rem; }

    .result-display { background: rgba(0, 211, 102, 0.1); border: 1px dashed var(--primary); padding: 15px; border-radius: 8px; text-align: center; font-size: 1.3rem; font-weight: bold; color: var(--primary); margin: 15px 0; }
    .chart-container { height: 300px; width: 100%; margin-top: 20px; }
    input { background: #0d1117; border: 1px solid #30363d; color: white; padding: 8px; border-radius: 4px; width: 100%; box-sizing: border-box; }
  </style>
</head>
<body>

  <header>
    <h1>JOE HUB <span>BIASHARA</span></h1>
    <div style="color: #8b949e;">Itemized Profit Manager & Tax Calculator</div>
  </header>

  <div class="action-bar">
    <button class="btn-refresh" onclick="refreshPage()">üîÑ Reset All</button>
    <button class="btn-pdf" onclick="downloadPDF()">üìÑ Download PDF Report</button>
  </div>

  <div class="dashboard-grid">
    
    <div class="card">
      <h3>üì¶ Add Item</h3>
      <input type="text" id="itemName" placeholder="Item Name (e.g. Shoes)">
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <input type="number" id="itemQty" placeholder="Qty" value="1">
        <input type="number" id="itemCost" placeholder="Buy Price">
        <input type="number" id="itemSell" placeholder="Sell Price">
      </div>
      <button class="btn-add" onclick="addItem()">+ Add to List</button>
      
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Profit</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="inventoryBody"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>üìä Performance Summary</h3>
      <div class="result-display" id="totalProfit">Total Profit: KES 0</div>
      <div style="font-size: 0.9rem; color: #8b949e;">
        Margin: <span id="totalMargin" style="color: var(--secondary);">0%</span>
      </div>
      <div class="chart-container">
        <canvas id="profitChart"></canvas>
      </div>
    </div>

    <div class="card">
      <h3>üí∏ Tax & Fee Checker</h3>
      <label style="font-size: 0.8rem; color: #8b949e;">Transaction Amount (KES)</label>
      <input type="number" id="sendAmount" placeholder="e.g. 1000" oninput="calcFees()">
      <select id="transType" onchange="calcFees()" style="width:100%; margin-top:10px; padding:8px; background:#0d1117; color:white; border:1px solid #30363d;">
        <option value="send">Send Money</option>
        <option value="withdraw">Agent Withdrawal</option>
      </select>
      <div class="result-display" style="color: var(--secondary); border-color: var(--secondary);" id="totalFee">Fee: KES 0</div>
      <div style="font-size: 0.8rem; color: #8b949e;">Includes 15% Govt Excise Tax: <span id="taxDisplay">KES 0</span></div>
    </div>

  </div>

  <script>
    let inventory = JSON.parse(localStorage.getItem('joeHubData')) || [];

    // Initialize Chart
    const ctx = document.getElementById('profitChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Total Cost', 'Total Profit'],
            datasets: [{ data: [1, 1], backgroundColor: ['#30363d', '#00D366'], borderWidth: 0 }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: 'white' } } } }
    });

    function addItem() {
        const name = document.getElementById('itemName').value;
        const qty = parseInt(document.getElementById('itemQty').value);
        const buy = parseFloat(document.getElementById('itemCost').value);
        const sell = parseFloat(document.getElementById('itemSell').value);

        if(!name || isNaN(buy) || isNaN(sell)) return alert("Please fill all item fields!");

        const profitPerItem = sell - buy;
        inventory.push({ name, qty, buy, sell, totalProfit: profitPerItem * qty });
        
        saveAndRefresh();
        // Clear inputs
        document.getElementById('itemName').value = '';
        document.getElementById('itemCost').value = '';
        document.getElementById('itemSell').value = '';
    }

    function deleteItem(index) {
        inventory.splice(index, 1);
        saveAndRefresh();
    }

    function saveAndRefresh() {
        localStorage.setItem('joeHubData', JSON.stringify(inventory));
        renderInventory();
        updateSummary();
    }

    function renderInventory() {
        const body = document.getElementById('inventoryBody');
        body.innerHTML = inventory.map((item, index) => `
            <tr>
                <td>${item.name}</td>
                <td>${item.qty}</td>
                <td style="color: var(--primary)">${item.totalProfit.toLocaleString()}</td>
                <td><button class="delete-btn" onclick="deleteItem(${index})">üóëÔ∏è</button></td>
            </tr>
        `).join('');
    }

    function updateSummary() {
        let totalProfit = 0;
        let totalCost = 0;
        let totalRevenue = 0;

        inventory.forEach(item => {
            totalProfit += item.totalProfit;
            totalCost += (item.buy * item.qty);
            totalRevenue += (item.sell * item.qty);
        });

        document.getElementById('totalProfit').innerText = `Total Profit: KES ${totalProfit.toLocaleString()}`;
        const margin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0;
        document.getElementById('totalMargin').innerText = `${margin}%`;

        myChart.data.datasets[0].data = [totalCost, totalProfit];
        myChart.update();
    }

    function calcFees() {
        const amt = parseFloat(document.getElementById('sendAmount').value) || 0;
        const type = document.getElementById('transType').value;
        let baseFee = (amt <= 100) ? 0 : (amt <= 1000) ? 12 : 25; // Simplified
        const tax = baseFee * 0.15;
        document.getElementById('totalFee').innerText = `Total: KES ${(baseFee + tax).toFixed(2)}`;
        document.getElementById('taxDisplay').innerText = `KES ${tax.toFixed(2)}`;
    }

    function refreshPage() {
        if(confirm("This will clear all saved data. Continue?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("JOE HUB BIASHARA - SALES REPORT", 14, 15);
        
        const rows = inventory.map(i => [i.name, i.qty, i.buy, i.sell, i.totalProfit]);
        doc.autoTable({
            head: [['Item', 'Qty', 'Buy Price', 'Sell Price', 'Net Profit']],
            body: rows,
            startY: 25
        });
        
        doc.save("JoeHub_Report.pdf");
    }

    // Initial Load
    renderInventory();
    updateSummary();
  </script>
</body>
</html>
